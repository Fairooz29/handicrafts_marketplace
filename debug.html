<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Debug - Handicrafts Marketplace</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .test-section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .test-section h3 { margin-top: 0; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        .loading { opacity: 0.6; }
    </style>
</head>
<body>
    <h1>Handicrafts Marketplace - Database Debug</h1>
    
    <div class="test-section">
        <h3>1. Server Environment Check</h3>
        <div id="env-check">
            <button onclick="checkEnvironment()">Check Environment</button>
            <div id="env-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>2. Database Connection Test</h3>
        <div id="db-test">
            <button onclick="testDatabase()">Test Database</button>
            <div id="db-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>3. API Endpoints Test</h3>
        <div id="api-test">
            <button onclick="testAPI()">Test Products API</button>
            <button onclick="testSimpleAPI()">Test Simple API</button>
            <div id="api-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>4. Frontend JavaScript Test</h3>
        <div id="js-test">
            <button onclick="testJavaScript()">Test JS Functions</button>
            <div id="js-results"></div>
        </div>
    </div>

    <div class="test-section">
        <h3>5. Manual Product Cards</h3>
        <div id="manual-test">
            <button onclick="createTestCards()">Create Test Cards</button>
            <div id="test-products" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-top: 1rem;"></div>
        </div>
    </div>

    <script>
        async function checkEnvironment() {
            const results = document.getElementById('env-results');
            results.innerHTML = '<p class="info">Checking environment...</p>';
            
            let html = '<h4>Environment Status:</h4><ul>';
            
            // Check if we're on localhost
            html += `<li>Current URL: ${window.location.href}</li>`;
            html += `<li>Protocol: ${window.location.protocol}</li>`;
            html += `<li>Host: ${window.location.host}</li>`;
            
            // Check if XAMPP is likely running
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            html += `<li class="${isLocalhost ? 'success' : 'error'}">Localhost: ${isLocalhost ? '✓' : '✗'}</li>`;
            
            html += '</ul>';
            results.innerHTML = html;
        }

        async function testDatabase() {
            const results = document.getElementById('db-results');
            results.innerHTML = '<p class="info">Testing database...</p>';
            
            try {
                const response = await fetch('test_db.php');
                const text = await response.text();
                results.innerHTML = `<h4>Database Test Results:</h4><div>${text}</div>`;
            } catch (error) {
                results.innerHTML = `<p class="error">Database test failed: ${error.message}</p>`;
            }
        }

        async function testAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML = '<p class="info">Testing API...</p>';
            
            try {
                console.log('Testing API endpoint: api/products.php?action=all');
                const response = await fetch('api/products.php?action=all');
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                let html = '<h4>API Test Results:</h4>';
                html += `<p class="success">✓ API responded successfully</p>`;
                html += `<p>Success: ${data.success}</p>`;
                
                if (data.success) {
                    html += `<p>Products found: ${data.products ? data.products.length : 0}</p>`;
                    if (data.products && data.products.length > 0) {
                        html += '<p class="success">✓ Products data available</p>';
                        html += '<h5>Sample Product:</h5>';
                        html += `<pre>${JSON.stringify(data.products[0], null, 2)}</pre>`;
                    } else {
                        html += '<p class="error">✗ No products in response</p>';
                    }
                } else {
                    html += `<p class="error">API Error: ${data.error}</p>`;
                }
                
                results.innerHTML = html;
                
            } catch (error) {
                console.error('API test error:', error);
                results.innerHTML = `
                    <h4>API Test Results:</h4>
                    <p class="error">✗ API test failed: ${error.message}</p>
                    <p>Possible issues:</p>
                    <ul>
                        <li>API files not found or accessible</li>
                        <li>Database connection issue</li>
                        <li>PHP errors in API files</li>
                        <li>CORS issues</li>
                    </ul>
                `;
            }
        }

        async function testSimpleAPI() {
            const results = document.getElementById('api-results');
            results.innerHTML += '<p class="info">Testing simple API...</p>';
            
            try {
                const response = await fetch('api/test_products.php');
                const text = await response.text();
                
                results.innerHTML += `
                    <h4>Simple API Test:</h4>
                    <pre>${text}</pre>
                `;
            } catch (error) {
                results.innerHTML += `<p class="error">Simple API test failed: ${error.message}</p>`;
            }
        }

        function testJavaScript() {
            const results = document.getElementById('js-results');
            
            let html = '<h4>JavaScript Test Results:</h4><ul>';
            
            // Check if main functions exist
            const functions = ['loadProducts', 'displayProducts', 'createProductCard'];
            functions.forEach(func => {
                const exists = typeof window[func] === 'function';
                html += `<li class="${exists ? 'success' : 'error'}">${func}: ${exists ? '✓' : '✗'}</li>`;
            });
            
            // Check if API_BASE is defined
            const apiBaseDefined = typeof API_BASE !== 'undefined';
            html += `<li class="${apiBaseDefined ? 'success' : 'error'}">API_BASE: ${apiBaseDefined ? '✓ ' + API_BASE : '✗'}</li>`;
            
            // Check DOM elements
            const elements = ['products-grid', 'loading-indicator', 'no-products'];
            elements.forEach(id => {
                const exists = document.getElementById(id) !== null;
                html += `<li class="${exists ? 'success' : 'error'}">Element #${id}: ${exists ? '✓' : '✗'}</li>`;
            });
            
            html += '</ul>';
            
            // Test manual API call
            html += '<h5>Manual API Test:</h5>';
            if (apiBaseDefined) {
                html += `<button onclick="manualAPITest()">Call loadProducts()</button>`;
            } else {
                html += '<p class="error">Cannot test - API_BASE not defined</p>';
            }
            
            results.innerHTML = html;
        }

        async function manualAPITest() {
            console.log('Manual API test started');
            if (typeof loadProducts === 'function') {
                try {
                    await loadProducts();
                    console.log('loadProducts() completed');
                } catch (error) {
                    console.error('loadProducts() failed:', error);
                }
            } else {
                console.error('loadProducts function not found');
            }
        }

        function createTestCards() {
            const container = document.getElementById('test-products');
            
            const testProducts = [
                {
                    id: 1,
                    name: "Test Terracotta Vase",
                    short_description: "Beautiful handcrafted vase for testing",
                    price: 1500,
                    original_price: 2000,
                    image: "assets/images/handicraft1.jpg",
                    category_name: "Pottery",
                    artisan_name: "Test Artisan",
                    stock_quantity: 10
                },
                {
                    id: 2,
                    name: "Test Embroidered Quilt",
                    short_description: "Hand-embroidered quilt for testing",
                    price: 3500,
                    original_price: null,
                    image: "assets/images/handicraft2.jpg",
                    category_name: "Embroidery",
                    artisan_name: "Test Artisan 2",
                    stock_quantity: 0
                }
            ];
            
            if (typeof createProductCard === 'function') {
                container.innerHTML = testProducts.map(product => createProductCard(product)).join('');
                
                // Bind events if function exists
                if (typeof bindProductCardEvents === 'function') {
                    bindProductCardEvents();
                }
            } else {
                container.innerHTML = '<p class="error">createProductCard function not available</p>';
            }
        }

        // Auto-run environment check
        window.addEventListener('load', checkEnvironment);
    </script>

    <!-- Include the main app script -->
    <script src="assets/js/app.js"></script>
</body>
</html>





